<template>
  <require from="./pool-country-selector"></require>
  <require from="./spinner"></require>
  <div class="prediction">
    <div class="well" if.bind="pool && !pool.user.isLoggedIn">You're not logged in.</div>
    <div class="panel panel-primary" if.bind="pool && pool.match && pool.match.length !== 0">
      <div class="panel-heading"><h3 class="panel-title">Games<span class="pull-right closing">Closing date: ${closingDate}</span></h3></div>
        <table class="table prediction">
        <tr>
          <th class="hidden-tn hidden-xxs hidden-xs">Game</th>
          <th class="hidden-tn hidden-xxs">Group</th>
          <th class="hidden-tn hidden-xxs"></th>
          <th class="hidden-tn hidden-xxs">Date</th>
          <th>Home</th>
          <th>Away</th>
          <th class="hidden-tn hidden-xxs hidden-xs hidden-sm">Result</th>
          <th class="hidden-tn hidden-xxs hidden-xs hidden-sm">Score</th>
          <th>Prediction</th>
        </tr>
        <tr repeat.for="schedule of match" click.trigger="selectSchedule(schedule)">
          <td class="hidden-tn hidden-xxs hidden-xs">${ schedule.matchId }</td>
          <td class="hidden-tn hidden-xxs">${ schedule.group }</td>
          <td class="hidden-tn hidden-xxs">${ formatDate(schedule.startDate, 'dd') }</td>
          <td class="hidden-tn hidden-xxs">${ formatDate(schedule.startDate, 'DD-MM-YYYY HH:mm') }</td>
          <td>
            <div class="visible-tn visible-xxs hidden-xs hidden-sm hidden-md hidden-lg">${ formatDate(schedule.startDate, 'D-M HH:mm') }</div>
            <img if.bind="imageUrl(schedule.country1Code)" src.bind="imageUrl(schedule.country1Code)" />
            <span class="visible-tn visible-xxs"></span><span class="visible-xs"></span>
            <span>${ schedule.country1 }</span>
          </td>
          <td>
            <div class="visible-tn visible-xxs hidden-xs hidden-sm hidden-md hidden-lg">${ schedule.group }</div>
            <img if.bind="imageUrl(schedule.country2Code)" src.bind="imageUrl(schedule.country2Code)" />
            <span class="visible-tn visible-xxs"></span><span class="visible-xs"></span>
            <span>${ schedule.country2 }</span>
          </td>
          <td class="hidden-tn hidden-xxs hidden-xs hidden-sm">
            <div class="visible-tn visible-xxs hidden-xs hidden-sm hidden-md hidden-lg">&nbsp;</div>
            <span class="visible-tn visible-xxs"></span><span class="visible-xs"></span>
            <div class="no-border">${ result(schedule) }</div>
          </td>
          <td class="hidden-tn hidden-xxs hidden-xs hidden-sm">
            <div class="visible-tn visible-xxs hidden-xs hidden-sm hidden-md hidden-lg">&nbsp;</div>
            <span class="visible-tn visible-xxs"></span><span class="visible-xs"></span>
            <div class="no-border">${ result(schedule) ? score(schedule) : '' }</div>
          </td>
          <td>
            <div class="visible-tn visible-xxs hidden-xs hidden-sm hidden-md hidden-lg">${ result(schedule) ? resultScore(schedule) : '&nbsp;' }</div>
            <div class="no-border inline">
              <div class="form-group no-border input" click.trigger="cancelBubbling($event)">
                <input type="tel" class="form-control" placeholder="0" value.bind="schedule.predictedGoals1 | numberToString & validateOnChange:controller:predictionRules" disabled.bind="isDisabled">
              </div>
              <div class="form-group no-border input" click.trigger="cancelBubbling($event)">
                <input type="tel" class="form-control" placeholder="0" value.bind="schedule.predictedGoals2 | numberToString & validateOnChange:controller:predictionRules" disabled.bind="isDisabled">
              </div>
            </div>
            <div class="visible-xs visible-sm hidden-md hidden-lg no-border">${ result(schedule) ? resultScore(schedule) : '' }</div>
          </td>
        </tr>
      </table>

      <pool-country-selector disable.bind="isDisabled" title.bind="'Round of 16'" max.bind="16" countries.bind="countries16 & signal:'data'" selected-countries.bind="selectedCountries16 & signal:'data'" predicted-countries.bind="predictedCountries(1) & signal:'data'"></pool-country-selector>
      <pool-country-selector disable.bind="isDisabled" title.bind="'Quarter-finals'" max.bind="8" countries.bind="countries8 & signal:'data'" selected-countries.bind="selectedCountries8 & signal:'data'" predicted-countries.bind="predictedCountries(2) & signal:'data'"></pool-country-selector>
      <pool-country-selector disable.bind="isDisabled" title.bind="'Semi-finals'" max.bind="4" countries.bind="countries4 & signal:'data'" selected-countries.bind="selectedCountries4 & signal:'data'" predicted-countries.bind="predictedCountries(3) & signal:'data'"></pool-country-selector>
      <pool-country-selector disable.bind="isDisabled" title.bind="'Finals'" max.bind="2" countries.bind="countries2 & signal:'data'" selected-countries.bind="selectedCountries2 & signal:'data'" predicted-countries.bind="predictedCountries(4) & signal:'data'"></pool-country-selector>
      <pool-country-selector if.bind="isWC" disable.bind="isDisabled" title.bind="'Third place'" max.bind="2" countries.bind="countries23 & signal:'data'" selected-countries.bind="selectedCountries23 & signal:'data'" predicted-countries.bind="predictedCountries(6) & signal:'data'"></pool-country-selector>
      <pool-country-selector if.bind="isWC" disable.bind="isDisabled" title.bind="'Third'" max.bind="1" countries.bind="countries13 & signal:'data'" selected-countries.bind="selectedCountries13 & signal:'data'" predicted-countries.bind="predictedCountries(7) & signal:'data'"></pool-country-selector>
      <pool-country-selector disable.bind="isDisabled" title.bind="'Champion'" max.bind="1" countries.bind="countries1 & signal:'data'" selected-countries.bind="selectedCountries1 & signal:'data'" predicted-countries.bind="predictedCountries(5) & signal:'data'"></pool-country-selector>

      <div class="buttons text-right">
        <button type="button" class="btn btn-primary" click.delegate="post()" disabled.bind="isDisabled"><spinner if.bind="disable"></spinner> Save</button>
      </div>
      <validation-summary
        errors.bind="controller.errors"
        controller.bind="controller"
        autofocus.bind="true">
        <template replace-part="error">
          ${$index+1}: ${error.message}
        </template>
      </validation-summary>
    </div>
  </div>
</template>